<div class="portlet light row">
    <div class="portlet-title">
        <div class="caption font-dark">
            <span class="caption-subject bold uppercase">仪表盘</span>
        </div>
    </div>
    <div ng-controller="DashboardController">
        <div class="row" ng-controller="statsController">
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 dashboard-stat white">
                    <div class="visual">
                        <i class="fa"></i>
                    </div>
                    <div class="details">
                        <div class="number counter-totalCount">  </div>
                        <div class="desc"> 总数据量</div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 dashboard-stat white">
                    <div class="visual">
                        <i class="fa"></i>
                    </div>
                    <div class="details">
                        <div class="number counter-monthCount">  </div>
                        <div class="desc"> 近一月增加</div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 dashboard-stat white">
                    <div class="visual">
                        <i class="fa"></i>
                    </div>
                    <div class="details">
                        <div class="number counter-weekCount"> </div>
                        <div class="desc"> 近一周增加</div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 ol-md-6 col-sm-6 col-xs-6">
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 dashboard-stat white">
                    <div class="visual">
                        <i class="fa"></i>
                    </div>
                    <div class="details">
                        <div class="number counter-totalDevice"> </div>
                        <div class="desc"> 总探针设备</div>
                    </div>

                </div>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 dashboard-stat white">
                    <div class="visual">
                        <i class="fa"></i>
                    </div>
                    <div class="details">
                        <div class="number counter-onlineDevice"></div>
                        <div class="desc"> 在线探针设备</div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 dashboard-stat white">
                    <div class="visual">
                        <i class="fa"></i>
                    </div>
                    <div class="details">
                        <div class="number counter-weeklyAddDevice"></div>
                        <div class="desc"> 近一周增加</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-9 col-md-9 col-sm-9 col-xs-9 chart-border" ng-controller="networkController">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <span class="chart-title">网络操作</span>
                    <span class="divider">|</span>
                    <span class="time-selected" id="network-time-selected"></span>
                    <img class="pull-right bar-charts" src="./icon/bar_chart.png" ng-click="chartChange('bar')">
                    <img class="pull-right line-charts" src="./icon/line_chart.png" ng-click="chartChange('line')">
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 chart-option">
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
                        <div>
                            <button class="date-range btn-default form-control"
                                    id="network-timerange">{{label}}<span class="caret date-range-caret"></span>
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
                        <div class="multi-dropdown"
                             ng-dropdown-multiselect
                             options="selectByGroupData"
                             selected-model="selectByGroupModel"
                             extra-settings="selectByGroupSettings"
                             group-by="group"
                             translation-texts="selectByGroupTexts"
                             events="groupChange">
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" id="network-chart" style="height: 300px;"></div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 chart-border" ng-controller="volumeController">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 chart-title">容量</div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" id="volume-chart" style="height:200px">Loading</div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <span class="col-lg-12 col-md-12 col-sm-12 col-xs-12 volume">{{StorageUsed}}</span>
                    <span class="col-lg-12 col-md-12 col-sm-12 col-xs-12 volume-des">已用空间</span>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <span class="col-lg-12 col-md-12 col-sm-12 col-xs-12 volume">{{StorageTotal}}</span>
                    <span class="col-lg-12 col-md-12 col-sm-12 col-xs-12 volume-des">总空间</span>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 col-lg-offset-3 col-md-offset-3 col-sm-offset-3 col-xs-offset-3 btn-manage">
                    <button class="btn-default form-control">管理空间</button>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 chart-border" ng-controller="systemController">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <span class="chart-title">系统操作</span>
                    <span class="divider">|</span>
                    <span class="time-selected" id="system-time-selected"></span>
                    <img class="pull-right bar-charts" src="./icon/bar_chart.png" ng-click="chartChange('bar')">
                    <img class="pull-right line-charts" src="./icon/line_chart.png" ng-click="chartChange('line')">
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 chart-option">
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                        <div>
                            <button class="date-range btn-default form-control"
                                    id="system-timerange">{{label}}<span class="caret date-range-caret"></span>
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
                        <div class="multi-dropdown"
                             ng-dropdown-multiselect
                             options="selectByGroupData"
                             selected-model="selectByGroupModel"
                             extra-settings="selectByGroupSettings"
                             group-by="group"
                             translation-texts="selectByGroupTexts"
                             events="groupChange">
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" id="system-chart" style="height: 300px"></div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 chart-border" ng-controller="processController">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <span class="chart-title">进程操作</span>
                    <span class="divider">|</span>
                    <span class="time-selected" id="process-time-selected"></span>
                    <img class="pull-right bar-charts" src="./icon/bar_chart.png" ng-click="chartChange('bar')">
                    <img class="pull-right line-charts" src="./icon/line_chart.png" ng-click="chartChange('line')">
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 chart-option">
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                        <div>
                            <button class="date-range btn-default form-control"
                                    id="process-timerange">{{label}}<span class="caret date-range-caret"></span>
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
                        <div class="multi-dropdown"
                             ng-dropdown-multiselect
                             options="selectByGroupData"
                             selected-model="selectByGroupModel"
                             extra-settings="selectByGroupSettings"
                             group-by="group"
                             translation-texts="selectByGroupTexts"
                             events="groupChange">
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" id="process-chart" style="height: 300px"></div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 chart-border" ng-controller="fileController">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <span class="chart-title">文件操作</span>
                    <span class="divider">|</span>
                    <span class="time-selected" id="file-time-selected"></span>
                    <img class="pull-right bar-charts" src="./icon/bar_chart.png" ng-click="chartChange('bar')">
                    <img class="pull-right line-charts" src="./icon/line_chart.png" ng-click="chartChange('line')">
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 chart-option">
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                        <div>
                            <button class="date-range btn-default form-control"
                                    id="file-timerange">{{label}}<span class="caret date-range-caret"></span>
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
                        <div class="multi-dropdown"
                             ng-dropdown-multiselect
                             options="selectByGroupData"
                             selected-model="selectByGroupModel"
                             extra-settings="selectByGroupSettings"
                             group-by="group"
                             translation-texts="selectByGroupTexts"
                             events="groupChange">
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" id="file-chart" style="height: 300px"></div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 chart-border" ng-controller="registryController">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <span class="chart-title">注册表操作</span>
                    <span class="divider">|</span>
                    <span class="time-selected" id="registry-time-selected"></span>
                    <img class="pull-right bar-charts" src="./icon/bar_chart.png" ng-click="chartChange('bar')">
                    <img class="pull-right line-charts" src="./icon/line_chart.png" ng-click="chartChange('line')">
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 chart-option">
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                        <div>
                            <button class="date-range btn-default form-control"
                                    id="registry-timerange">{{label}}<span class="caret date-range-caret"></span>
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
                        <div class="multi-dropdown"
                             ng-dropdown-multiselect
                             options="selectByGroupData"
                             selected-model="selectByGroupModel"
                             extra-settings="selectByGroupSettings"
                             group-by="group"
                             translation-texts="selectByGroupTexts"
                             events="groupChange">
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" id="registry-chart" style="height: 300px"></div>
            </div>
        </div>

    </div>
</div>
<script src="./assets/global/plugins/bootstrap-daterangepicker/moment.min.js" type="text/javascript"></script>
<script src="./assets/global/plugins/bootstrap-daterangepicker/daterangepicker.js" type="text/javascript"></script>
<!-- BEGIN MAIN CONTENT -->
<script>
    Date.prototype.format = function (fmt) {
        var o = {
            "M+": this.getMonth() + 1,                 //月份
            "d+": this.getDate(),                    //日
            "h+": this.getHours(),                   //小时
            "m+": this.getMinutes(),                 //分
            "s+": this.getSeconds(),                 //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds()             //毫秒
        };
        if (/(y+)/.test(fmt)) {
            fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        }
        for (var k in o) {
            if (new RegExp("(" + k + ")").test(fmt)) {
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            }
        }
        return fmt;
    };

    var timeStamp2String = function (time, format) {
        if (typeof(time) == "number") {
            time = time.toString();
        }
        if (time.length != 10 && time.length != 13) {
            return time;
        }
        if (time.length == 10) {
            time = time * 1000;
        }
        var datetime = new Date();
        datetime.setTime(time);
        return datetime.format(format);
    };

    var initialStartTime = Math.floor((moment().subtract('hours', 24).unix() / 3600) + 1) * 3600;
    var initialEndTime = moment().unix();

    $('#network-time-selected').html(timeStamp2String(initialStartTime, "yyyy-MM-dd hh:mm") + ' 至 ' + timeStamp2String(initialEndTime, "yyyy-MM-dd hh:mm"));
    $('#system-time-selected').html(timeStamp2String(initialStartTime, "yyyy-MM-dd hh:mm") + ' 至 ' + timeStamp2String(initialEndTime, "yyyy-MM-dd hh:mm"));
    $('#process-time-selected').html(timeStamp2String(initialStartTime, "yyyy-MM-dd hh:mm") + ' 至 ' + timeStamp2String(initialEndTime, "yyyy-MM-dd hh:mm"));
    $('#file-time-selected').html(timeStamp2String(initialStartTime, "yyyy-MM-dd hh:mm") + ' 至 ' + timeStamp2String(initialEndTime, "yyyy-MM-dd hh:mm"));
    $('#registry-time-selected').html(timeStamp2String(initialStartTime, "yyyy-MM-dd hh:mm") + ' 至 ' + timeStamp2String(initialEndTime, "yyyy-MM-dd hh:mm"));

    var device_info = [];
    function getDeviceInfo() {
        $.ajax({
            async: false,
            url: "deviceinfo",
            type: "GET",
            dataType: "json",
            success: function (data) {
                device_info = data.data
            }
        });
        return device_info;
    }
    device_info = getDeviceInfo();

    var getSubtype = function(eventType, subType) {
        data = {
            1: {
                1: "创建文件",
                2: "打开文件",
                3: "读文件",
                4: "写文件",
                5: "删除文件",
                6: "重命名文件",
                7: "查询文件信息",
                8: "修改文件信息",
                9: "关闭文件"
            },
            2: {
                1: "进程加载",
                2: "进程终止"
            },
            3: {
                1: "Web",
                2: "邮件",
                3: "文件传输",
                4: "其他应用程序"
            },
            4: {
                1: "系统登录",
                2: "挂载",
                3: "取消挂载",
                4: "网络连接",
                5: "断开网络连接",
                6: "修改密码"
            },
            5: {
                1: "注册表创建",
                2: "注册表打开",
                3: "注册表删除",
                4: "注册表查询",
                5: "注册表设置"
            }
        };

        var res;
        if (eventType in data && subType in data[eventType]) {
            res = data[eventType][subType];
        }
        else {
            res = "unknown";
        }
        return res;
    };

    var getStack = function(type, stack) {
        if (type === 'bar') {
            return "total"
        }
        else {
            return stack
        }
    };

    var getBarColor = function(index) {
        var colorSet = ['#ff2925', '#7030be', '#0096fb', '#c8df00', '#f8aa27', '#795548', '#48cc48', '#fd9cb9', '#bbbcf9'];
        return colorSet[(index - 1)]
    };

    var getBoundaryGap = function(chartType) {
        if (chartType === "bar") {
            return true
        }
        else {
            return false

        }
    };

    var queryDashboard = function (label, eventType, beginTime, endTime, device, chartType, myChart) {
        var xAxisFormat = function (xData) {
            for (var i = 0; i < xData.length; i++) {
                if (label === "24H") {
                    xData[i] = timeStamp2String(xData[i], "yyyy-MM-dd hh:mm")
                }
                else {
                    xData[i] = timeStamp2String(xData[i], "yyyy-MM-dd");
                }
            }
            return xData;
        };
        var getLegendData = function(yData, eventType) {
            var legendData = [];
            for (var item in yData) {
                legendData.push(getSubtype(eventType, item))
            }
            if (legendData.length > 5) {
                legendData.splice(5, 0, "")
            }
            return legendData
        };
        var seriesFormat = function (yData, type, eventType) {
            var seriesData = [];
            for (var item in yData) {
                seriesData.push(
                    {
                        "name": getSubtype(eventType, item),
                        "type": type,
                        "stack": getStack(type, item),
                        "barWidth": 10,
                        "barGap": "10%",
                        "barMinHeight": 1,
                        "smooth": true,
                        "itemStyle": {
                            "normal": {
                                "color": getBarColor(item),
                                "label": {
                                    "show": false,
                                    "textStyle": {
                                        "color": "#fff"
                                    },
                                    "position": "insideTop",
                                    formatter: function (p) {
                                        return p.value > 0 ? (p.value) : '';
                                    }
                                }
                            }
                        },
                        "data": yData[item]
                    });
            }
            return seriesData
        };
        $.ajax({
            async: false,
            url: "dashboardquery",
            type: "POST",
            dataType: "json",
            data: JSON.stringify({
                "eventtype": eventType,
                "period": label,
                "begintime": beginTime,
                "endtime": endTime,
                "devices": device
            }),
            success: function (data) {
                option = {
                    xAxis: {
                        data: xAxisFormat(data.xData)
                    },
                    legend: {
                        data: getLegendData(data.yData, eventType)
                    },
                    series: seriesFormat(data.yData, chartType, eventType)
                };
                myChart.setOption(option)
            }
        });
    };

    var chartDraw = function (label, eventType, beginTime, endTime, device, chartType, myChart) {
        label = getLabel(label);
        var option = {
            backgroundColor: "#ffffff",
            "tooltip": {
                "trigger": "axis",
                "axisPointer": {
                    "type": "shadow",
                    textStyle: {
                        color: "#fff"
                    }
                }
            },
            "toolbox": {
                show : true,
                right: "10%",
                feature : {
                    mark : {show: true},
                    dataView : {show: true, readOnly: true},
                    dataZoom : {show: true, yAxisIndex: false},
//                    magicType : {show: true, type: ['tiled']},
                    restore : {show: true},
                    saveAsImage : {show: true}
                }
            },
            "grid": {
                "borderWidth": 0,
                "top": 20,
                "bottom": 80,
                textStyle: {
                    color: "#fff"
                }
            },
            "legend": {
                x: '10%',
                top: '80%',
                textStyle: {
                    color: '#363b4e'
                }
            },
            "calculable": true,
            "xAxis": [{
                "type": "category",
                "axisLine": {
                    lineStyle: {
                        color: '#363b4e'
                    }
                },
                "splitLine": {
                    "show": false
                },
                "axisTick": {
                    "show": false
                },
                "splitArea": {
                    "show": false
                },
                "axisLabel": {
                    "interval": "auto"
                },
                boundaryGap: getBoundaryGap(chartType)
            }],
            "yAxis": [{
                "type": "value",
                "splitLine": {
                    "show": false
                },
                "axisLine": {
                    lineStyle: {
                        color: '#363b4e'
                    }
                },
                "axisTick": {
                    "show": false
                },
                "axisLabel": {
                    "interval": "auto"
                },
                "splitArea": {
                    "show": false
                }

            }]
            // "dataZoom": [{
            //     "show": true,
            //     "height": 30,
            //     "xAxisIndex": [
            //         0
            //     ],
            //     bottom: 30,
            //     "start": 10,
            //     "end": 80,
            //     handleIcon: 'path://M306.1,413c0,2.2-1.8,4-4,4h-59.8c-2.2,0-4-1.8-4-4V200.8c0-2.2,1.8-4,4-4h59.8c2.2,0,4,1.8,4,4V413z',
            //     handleSize: '110%',
            //     handleStyle:{
            //         color:"#d3dee5",

            //     },
            //       textStyle:{
            //         color:"#fff"},
            //       borderColor:"#90979c"


            // }, {
            //     "type": "inside",
            //     "show": true,
            //     "height": 15,
            //     "start": 1,
            //     "end": 35
            // }],
        };
        myChart.setOption(option);
        queryDashboard(label, eventType, beginTime, endTime, device, chartType, myChart)
    };

    function statsController() {
        var device_num;
        $.ajax({
            async: false,
            url: "devicenum",
            type: "GET",
            dataType: "json",
            success: function(data) {
                device_num = data
            }
        });
        var dashboard_sum;
        $.ajax({
            async: false,
            url: "dashboardsum",
            type: "GET",
            dataType: "json",
            success: function(data) {
                dashboard_sum = data
            }
        });

        $('.counter-totalDevice').counterUp({
            delay: 10,
            time: 100,
            value: device_num.totalnum
        });

        $('.counter-onlineDevice').counterUp({
            delay: 10,
            time: 100,
            value: device_num.onlinenum
        });

        $('.counter-weeklyAddDevice').counterUp({
            delay: 10,
            time: 100,
            value: device_num.weeknum,
            needAdd: 1
        });

        $('.counter-totalCount').counterUp({
            delay: 10,
            time: 400,
            value: dashboard_sum["total"]
        });

        $('.counter-monthCount').counterUp({
            delay: 10,
            time: 400,
            value: dashboard_sum["30D"],
            needAdd: 1
        });

        $('.counter-weekCount').counterUp({
            delay: 10,
            time: 400,
            value: dashboard_sum["7D"],
            needAdd: 1
        });

    }

    var statsInterval = setInterval(statsController, 60000);

    var getLabel = function(label) {
        if (label === "过去24小时") {
            return "24H"
        }
        if (label === "过去7天") {
            return "7D"
        }
        if (label === "过去30天") {
            return "30D"
        }
        return label
    };

    var selectDevice = function (model) {
        if (model.length == 0) {
            return ["all"]
        }
        else {
            var res = [];
            for (var i = 0; i < model.length; i++) {
                res.push(model[i].id)
            }
            return res
        }
    };

    var volumeInterval;
    var networkInterval;
    var systemInterval;
    var processInterval;
    var fileInterval;
    var registryInterval;

    function volumeController($scope) {
        var dom = document.getElementById("volume-chart");
        var myChart = echarts.init(dom);

        var option = {
            series: [{
                type: 'liquidFill',
                radius: '80%',
                label: {
                    normal: {
                        textStyle: {
                            color: 'red',
                            insideColor: 'white',
                            fontSize: 50
                        }
                    }
                }
            }]
        };
        myChart.setOption(option);

        var formatVolume = function(volume) {
            var index = volume.indexOf("M");
            var volumeNum = volume.substr(0, index);
            if ((volumeNum / 1024) >= 1) {
                volume = Math.round((volumeNum / 1024)) + "GB";
            }
            return volume
        };

        var getColor = function(value) {
            if (value < 0.6) {
                result = {
                    value: value,
                    itemStyle: {
                        normal: {
                            color: 'blue'
                        }
                    }
                };
                return result
            }
            if (value >= 0.6 && value < 0.9) {
                result = {
                    value: value,
                    itemStyle: {
                        normal: {
                            color: 'yellow'
                        }
                    }
                };
                return result
            }
            if (value >= 0.9) {
                result = {
                    value: value,
                    itemStyle: {
                        normal: {
                            color: 'red'
                        }
                    }
                };
                return result
            }
        };

        var volumeDraw = function () {
            myChart.showLoading();
            $.ajax({
                async: false,
                url: "diskinfo",
                type: "GET",
                dataType: "json",
                success: function(data) {
                    $scope.StorageUsed = formatVolume(data.StorageUsed);
                    $scope.StorageTotal = formatVolume(data.StorageTotal);
                    myChart.hideLoading();
                    myChart.setOption(
                        {
                            series: {
                                data: [
                                    data.StorageUsedPercent
                                ]
                            }
                        })
                }
            });
        };

        volumeDraw();
        volumeInterval = setInterval(volumeDraw, 60000);
    }

    function networkController($scope) {
        $scope.selectByGroupModel = [];
        $scope.selectByGroupData = [];
        $scope.groupInfo = [];
        for (var i = 0; i < device_info.length; i++) {
            var devices = device_info[i].devices;
            $scope.groupInfo.push(device_info[i].groupname);
            for (var k = 0; k < devices.length; k++) {
                var device = {
                    id: devices[k].deviceid,
                    label: devices[k].devicename,
                    group: device_info[i].groupname
                };
                $scope.selectByGroupData.push(device)
            }
        }

        $scope.selectByGroupSettings = {
            selectByGroups: $scope.groupInfo,
            groupByTextProvider: function (groupValue) {
                return groupValue
            },
            scrollableHeight: '400px',
            scrollable: true,
            enableSearch: true
        };

        $scope.selectByGroupTexts = {
            buttonDefaultText: "所有探针设备...",
            selectGroup: '选择所有:',
            allSelectedText: '全部',
            searchPlaceholder: '检索...',
            checkAll: '选择所有',
            uncheckAll: '取消所有选择',
            selectionCount: '被选中'
        };

        $scope.startTime = initialStartTime;
        $scope.endTime = initialEndTime;
        $scope.label = "过去24小时";
        $scope.chartType = 'bar';

        var dom = document.getElementById("network-chart");
        var myChart = echarts.init(dom);

        var loopNetwork = function() {
            chartDraw($scope.label, 3, $scope.startTime, $scope.endTime, selectDevice($scope.selectByGroupModel), $scope.chartType, myChart);

        };
        loopNetwork();
        networkInterval = setInterval(loopNetwork, 60000);

        $('#network-timerange').daterangepicker({
            "showCustomRangeLabel": false,
            "autoApply": true,
            "timePicker": true,
            "applyClass": "btn-hide",
            "cancelClass": "btn-hide",
            "startDate": moment().startOf('hour').subtract('hours', 23),
            "endDate": moment().endOf('minute'),
            "ranges": {
                "过去24小时": [moment().startOf('hour').subtract('hours', 23), moment().endOf('minute')],
                "过去7天": [moment().subtract('days', 7), moment()],
                "过去30天": [moment().subtract('days', 30), moment()]
            },
            "locale": {
                "format": "YYYY/MM/DD HH:mm"
            }
        }, function (start, end, label) {
            if (label === "过去24小时") {
                $scope.startTime = Math.ceil(start / 3600000) * 3600;
            }
            else {
                $scope.startTime = Math.ceil(start / 86400000) * 86400 - 28800;
            }
            $scope.endTime = Math.floor(end / 60000) * 60;
            $("#network-time-selected").html(timeStamp2String($scope.startTime, "yyyy-MM-dd hh:mm") + ' 至 ' + timeStamp2String($scope.endTime, "yyyy-MM-dd hh:mm"));
            $scope.label = label;

            clearInterval(networkInterval);
//            var loopNetworkDraw = function() {
//                chartDraw($scope.label, 3, startTime, moment().unix(), selectDevice($scope.selectByGroupModel), 'bar', myChart);
//            };
            loopNetwork();
            networkInterval = setInterval(loopNetwork, 60000)
        });

        $scope.chartChange = function(type) {
            $scope.chartType = type;
            clearInterval(networkInterval);
            loopNetwork();
            networkInterval = setInterval(loopNetwork, 60000)
        };

        $scope.groupChange = {
            'onSelectionChanged': function () { // This event is not firing on selection of max limit
                console.log('111');
                clearInterval(networkInterval);
                loopNetwork();
                networkInterval = setInterval(loopNetwork, 60000)
            }
        }
    }

    function systemController($scope) {
        $scope.selectByGroupModel = [];

        $scope.selectByGroupData = [];
        $scope.groupInfo = [];
        for (var i = 0; i < device_info.length; i++) {
            var devices = device_info[i].devices;
            $scope.groupInfo.push(device_info[i].groupname);
            for (var k = 0; k < devices.length; k++) {
                var device = {
                    id: devices[k].deviceid,
                    label: devices[k].devicename,
                    group: device_info[i].groupname
                };
                $scope.selectByGroupData.push(device)
            }
        }

        $scope.selectByGroupSettings = {
            selectByGroups: $scope.groupInfo,
            groupByTextProvider: function (groupValue) {
                return groupValue
            },
            scrollableHeight: '400px',
            scrollable: true,
            enableSearch: true
        };

        $scope.selectByGroupTexts = {
            buttonDefaultText: "所有探针设备...",
            selectGroup: '选择所有:',
            allSelectedText: '全部',
            searchPlaceholder: '检索...',
            checkAll: '选择所有',
            uncheckAll: '取消所有选择',
            selectionCount: '被选中'
        };
        $scope.startTime = initialStartTime;
        $scope.endTime = initialEndTime;
        $scope.label = "过去24小时";
        $scope.chartType = 'bar';

        var dom = document.getElementById("system-chart");
        var myChart = echarts.init(dom);

        var loopSystem = function() {
            chartDraw($scope.label, 4, $scope.startTime, $scope.endTime, selectDevice($scope.selectByGroupModel), $scope.chartType, myChart);

        };
        loopSystem();
        systemInterval = setInterval(loopSystem, 60000);

        $('#system-timerange').daterangepicker({
            "showCustomRangeLabel": false,
            "autoApply": true,
            "timePicker": true,
            "applyClass": "btn-hide",
            "cancelClass": "btn-hide",
            "startDate": moment().subtract('hours', 24),
            "endDate": moment(),
            "ranges": {
                "过去24小时": [moment().subtract('hours', 24), moment()],
                "过去7天": [moment().subtract('days', 7), moment()],
                "过去30天": [moment().subtract('days', 30), moment()]
            },
            "locale": {
                "format": "YYYY/MM/DD HH:mm"
            }
        }, function (start, end, label) {
            if (label === "过去24小时") {
                $scope.startTime = Math.ceil(start / 3600000) * 3600;
            }
            else {
                $scope.startTime = Math.ceil(start / 86400000) * 86400 - 28800;
            }
            $("#system-time-selected").html(timeStamp2String($scope.startTime, "yyyy-MM-dd hh:mm") + ' 至 ' + timeStamp2String($scope.endTime, "yyyy-MM-dd hh:mm"));
            $scope.label = label;

            clearInterval(systemInterval);

            loopSystem();
            systemInterval = setInterval(loopSystem, 60000)
        });

        $scope.chartChange = function(type) {
            $scope.chartType = type;
            clearInterval(systemInterval);
            loopSystem();
            systemInterval = setInterval(loopSystem, 60000)
        };

        $scope.groupChange = {
            'onSelectionChanged': function () { // This event is not firing on selection of max limit
                clearInterval(systemInterval);
                loopSystem();
                systemInterval = setInterval(loopSystem, 60000)
            }
        }
    }

//    var systemDraw = function (label) {
//        var dom = document.getElementById("system-chart");
//        var myChart = echarts.init(dom);
//        var xData = getData(label);
//        var option = {
//            backgroundColor: "#ffffff",
//            "tooltip": {
//                "trigger": "axis",
//                "axisPointer": {
//                    "type": "shadow",
//                    textStyle: {
//                        color: "#fff"
//                    }
//                }
//            },
//            "grid": {
//                "borderWidth": 0,
//                "top": 40,
//                "bottom": 50,
//                textStyle: {
//                    color: "#fff"
//                }
//            },
//            "legend": {
//                x: '4%',
//                top: '92%',
//                textStyle: {
//                    color: '#363b4e'
//                },
//                "data": ['登录', '注销', '修改密码', '移动设备接入', '移动设备拔出']
//            },
//
//
//            "calculable": true,
//            "xAxis": [{
//                "type": "category",
//                "axisLine": {
//                    lineStyle: {
//                        color: '#363b4e'
//                    }
//                },
//                "splitLine": {
//                    "show": false
//                },
//                "axisTick": {
//                    "show": false
//                },
//                "splitArea": {
//                    "show": false
//                },
//                "axisLabel": {
//                    "interval": "auto"
//
//                },
//                "data": xData
//            }],
//            "yAxis": [{
//                "type": "value",
//                "splitLine": {
//                    "show": false
//                },
//                "axisLine": {
//                    lineStyle: {
//                        color: '#363b4e'
//                    }
//                },
//                "axisTick": {
//                    "show": false
//                },
//                "axisLabel": {
//                    "interval": "auto"
//                },
//                "splitArea": {
//                    "show": false
//                }
//
//            }],
//            // "dataZoom": [{
//            //     "show": true,
//            //     "height": 30,
//            //     "xAxisIndex": [
//            //         0
//            //     ],
//            //     bottom: 30,
//            //     "start": 10,
//            //     "end": 80,
//            //     handleIcon: 'path://M306.1,413c0,2.2-1.8,4-4,4h-59.8c-2.2,0-4-1.8-4-4V200.8c0-2.2,1.8-4,4-4h59.8c2.2,0,4,1.8,4,4V413z',
//            //     handleSize: '110%',
//            //     handleStyle:{
//            //         color:"#d3dee5",
//
//            //     },
//            //       textStyle:{
//            //         color:"#fff"},
//            //       borderColor:"#90979c"
//
//
//            // }, {
//            //     "type": "inside",
//            //     "show": true,
//            //     "height": 15,
//            //     "start": 1,
//            //     "end": 35
//            // }],
//            "series": [{
//                "name": "登录",
//                "type": "bar",
//                "stack": "总量",
//                "barWidth": 10,
//                "barGap": "10%",
//                "itemStyle": {
//                    "normal": {
//                        "color": "#ff2925",
//                        "label": {
//                            "show": false,
//                            "textStyle": {
//                                "color": "#fff"
//                            },
//                            "position": "insideTop",
//                            formatter: function (p) {
//                                return p.value > 0 ? (p.value) : '';
//                            }
//                        }
//                    }
//                },
//                "data": [
//                    198,
//                    330,
//                    151,
//                    160,
//                    222,
//                    229,
//                    128,
//                    250,
//                    224,
//                    473,
//                    126,
//                    260
//                ]
//            },
//
//                {
//                    "name": "注销",
//                    "type": "bar",
//                    "stack": "总量",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#7030be",
//                            "barBorderRadius": 0,
//                            "label": {
//                                "show": false,
//                                "position": "top",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        82,
//                        67,
//                        62,
//                        59,
//                        67,
//                        67,
//                        35,
//                        71,
//                        81,
//                        78,
//                        79,
//                        72
//                    ]
//                },
//
//                {
//                    "name": "修改密码",
//                    "type": "bar",
//                    "stack": "总量",
//                    "barMaxWidth": 35,
//                    "barGap": "10%",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#0096fb",
//                            "label": {
//                                "show": false,
//                                "textStyle": {
//                                    "color": "#fff"
//                                },
//                                "position": "insideTop",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        198,
//                        330,
//                        151,
//                        160,
//                        222,
//                        229,
//                        128,
//                        250,
//                        224,
//                        473,
//                        126,
//                        260
//                    ]
//                },
//
//                {
//                    "name": "移动设备接入",
//                    "type": "bar",
//                    "stack": "总量",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#c8df00",
//                            "barBorderRadius": 0,
//                            "label": {
//                                "show": false,
//                                "position": "top",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        82,
//                        67,
//                        62,
//                        59,
//                        67,
//                        67,
//                        35,
//                        71,
//                        81,
//                        78,
//                        79,
//                        72
//                    ]
//                },
//
//                {
//                    "name": "移动设备拔出",
//                    "type": "bar",
//                    "stack": "总量",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#f8aa27",
//                            "barBorderRadius": 0,
//                            "label": {
//                                "show": false,
//                                "position": "top",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        82,
//                        67,
//                        62,
//                        59,
//                        67,
//                        67,
//                        35,
//                        71,
//                        81,
//                        78,
//                        79,
//                        72
//                    ]
//                }
//            ]
//        };
//
//        myChart.setOption(option);
//
//    };
//
//    systemDraw("今天");

    function processController($scope) {
        $scope.selectByGroupModel = [];

        $scope.selectByGroupData = [];
        $scope.groupInfo = [];
        for (var i = 0; i < device_info.length; i++) {
            var devices = device_info[i].devices;
            $scope.groupInfo.push(device_info[i].groupname);
            for (var k = 0; k < devices.length; k++) {
                var device = {
                    id: devices[k].deviceid,
                    label: devices[k].devicename,
                    group: device_info[i].groupname
                };
                $scope.selectByGroupData.push(device)
            }
        }

        $scope.selectByGroupSettings = {
            selectByGroups: $scope.groupInfo,
            groupByTextProvider: function (groupValue) {
                return groupValue
            },
            scrollableHeight: '400px',
            scrollable: true,
            enableSearch: true
        };

        $scope.selectByGroupTexts = {
            buttonDefaultText: "所有探针设备...",
            selectGroup: '选择所有:',
            allSelectedText: '全部',
            searchPlaceholder: '检索...',
            checkAll: '选择所有',
            uncheckAll: '取消所有选择',
            selectionCount: '被选中'
        };
        $scope.startTime = initialStartTime;
        $scope.endTime = initialEndTime;
        $scope.label = "过去24小时";
        $scope.chartType = 'bar';

        var dom = document.getElementById("process-chart");
        var myChart = echarts.init(dom);

        var loopProcess = function() {
            chartDraw($scope.label, 2, $scope.startTime, $scope.endTime, selectDevice($scope.selectByGroupModel), $scope.chartType, myChart);

        };
        loopProcess();
        processInterval = setInterval(loopProcess, 60000);

        $('#process-timerange').daterangepicker({
            "showCustomRangeLabel": false,
            "autoApply": true,
            "timePicker": true,
            "applyClass": "btn-hide",
            "cancelClass": "btn-hide",
            "startDate": moment().subtract('hours', 24),
            "endDate": moment(),
            "ranges": {
                "过去24小时": [moment().subtract('hours', 24), moment()],
                "过去7天": [moment().subtract('days', 7), moment()],
                "过去30天": [moment().subtract('days', 30), moment()]
            },
            "locale": {
                "format": "YYYY/MM/DD HH:mm"
            }
        }, function (start, end, label) {
            if (label === "过去24小时") {
                $scope.startTime = Math.ceil(start / 3600000) * 3600;
            }
            else {
                $scope.startTime = Math.ceil(start / 86400000) * 86400 - 28800;
            }
            $("#process-time-selected").html(timeStamp2String($scope.startTime, "yyyy-MM-dd hh:mm") + ' 至 ' + timeStamp2String($scope.endTime, "yyyy-MM-dd hh:mm"));
            $scope.label = label;

            clearInterval(processInterval);

            loopProcess();
            processInterval = setInterval(loopProcess, 60000)

        });

        $scope.chartChange = function(type) {
            $scope.chartType = type;
            clearInterval(processInterval);
            loopProcess();
            processInterval = setInterval(loopProcess, 60000)
        };

        $scope.groupChange = {
            'onSelectionChanged': function () { // This event is not firing on selection of max limit
                clearInterval(processInterval);
                loopProcess();
                processInterval = setInterval(loopProcess, 60000)
            }
        }
    }

//    var processDraw = function (label) {
//        var dom = document.getElementById("process-chart");
//        var myChart = echarts.init(dom);
//        var xData = getData(label);
//
//        var option = {
//            backgroundColor: "#ffffff",
//            "tooltip": {
//                "trigger": "axis",
//                "axisPointer": {
//                    "type": "shadow",
//                    textStyle: {
//                        color: "#fff"
//                    }
//                }
//            },
//            "grid": {
//                "borderWidth": 0,
//                "top": 40,
//                "bottom": 50,
//                textStyle: {
//                    color: "#fff"
//                }
//            },
//            "legend": {
//                x: '4%',
//                top: '92%',
//                left: '25%',
//                textStyle: {
//                    color: '#363b4e'
//                },
//                "data": ['创建进程', '终止进程', '加载模块']
//            },
//
//
//            "calculable": true,
//            "xAxis": [{
//                "type": "category",
//                "axisLine": {
//                    lineStyle: {
//                        color: '#363b4e'
//                    }
//                },
//                "splitLine": {
//                    "show": false
//                },
//                "axisTick": {
//                    "show": false
//                },
//                "splitArea": {
//                    "show": false
//                },
//                "axisLabel": {
//                    "interval": "auto"
//
//                },
//                "data": xData
//            }],
//            "yAxis": [{
//                "type": "value",
//                "splitLine": {
//                    "show": false
//                },
//                "axisLine": {
//                    lineStyle: {
//                        color: '#363b4e'
//                    }
//                },
//                "axisTick": {
//                    "show": false
//                },
//                "axisLabel": {
//                    "interval": "auto"
//                },
//                "splitArea": {
//                    "show": false
//                }
//
//            }],
//            // "dataZoom": [{
//            //     "show": true,
//            //     "height": 30,
//            //     "xAxisIndex": [
//            //         0
//            //     ],
//            //     bottom: 30,
//            //     "start": 10,
//            //     "end": 80,
//            //     handleIcon: 'path://M306.1,413c0,2.2-1.8,4-4,4h-59.8c-2.2,0-4-1.8-4-4V200.8c0-2.2,1.8-4,4-4h59.8c2.2,0,4,1.8,4,4V413z',
//            //     handleSize: '110%',
//            //     handleStyle:{
//            //         color:"#d3dee5",
//
//            //     },
//            //       textStyle:{
//            //         color:"#fff"},
//            //       borderColor:"#90979c"
//
//
//            // }, {
//            //     "type": "inside",
//            //     "show": true,
//            //     "height": 15,
//            //     "start": 1,
//            //     "end": 35
//            // }],
//            "series": [{
//                "name": "创建进程",
//                "type": "bar",
//                "stack": "总量",
//                "barWidth": 10,
//                "barGap": "10%",
//                "itemStyle": {
//                    "normal": {
//                        "color": "#ff2925",
//                        "label": {
//                            "show": false,
//                            "textStyle": {
//                                "color": "#fff"
//                            },
//                            "position": "insideTop",
//                            formatter: function (p) {
//                                return p.value > 0 ? (p.value) : '';
//                            }
//                        }
//                    }
//                },
//                "data": [
//                    198,
//                    330,
//                    151,
//                    160,
//                    222,
//                    229,
//                    128,
//                    250,
//                    224,
//                    473,
//                    126,
//                    260
//                ]
//            },
//
//                {
//                    "name": "终止进程",
//                    "type": "bar",
//                    "stack": "总量",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#7030be",
//                            "barBorderRadius": 0,
//                            "label": {
//                                "show": false,
//                                "position": "top",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        82,
//                        67,
//                        62,
//                        59,
//                        67,
//                        67,
//                        35,
//                        71,
//                        81,
//                        78,
//                        79,
//                        72
//                    ]
//                },
//
//                {
//                    "name": "加载模块",
//                    "type": "bar",
//                    "stack": "总量",
//                    "barMaxWidth": 35,
//                    "barGap": "10%",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#0096fb",
//                            "label": {
//                                "show": false,
//                                "textStyle": {
//                                    "color": "#fff"
//                                },
//                                "position": "insideTop",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        198,
//                        330,
//                        151,
//                        160,
//                        222,
//                        229,
//                        128,
//                        250,
//                        224,
//                        473,
//                        126,
//                        260
//                    ]
//                }
//            ]
//        };
//
//        myChart.setOption(option);
//    };
//
//    processDraw("今天");

    function fileController($scope) {
        $scope.selectByGroupModel = [];

        $scope.selectByGroupData = [];
        $scope.groupInfo = [];
        for (var i = 0; i < device_info.length; i++) {
            var devices = device_info[i].devices;
            $scope.groupInfo.push(device_info[i].groupname);
            for (var k = 0; k < devices.length; k++) {
                var device = {
                    id: devices[k].deviceid,
                    label: devices[k].devicename,
                    group: device_info[i].groupname
                };
                $scope.selectByGroupData.push(device)
            }
        }

        $scope.selectByGroupSettings = {
            selectByGroups: $scope.groupInfo,
            groupByTextProvider: function (groupValue) {
                return groupValue
            },
            scrollableHeight: '400px',
            scrollable: true,
            enableSearch: true
        };

        $scope.selectByGroupTexts = {
            buttonDefaultText: "所有探针设备...",
            selectGroup: '选择所有:',
            allSelectedText: '全部',
            searchPlaceholder: '检索...',
            checkAll: '选择所有',
            uncheckAll: '取消所有选择',
            selectionCount: '被选中'
        };
        $scope.startTime = initialStartTime;
        $scope.endTime = initialEndTime;
        $scope.label = "过去24小时";
        $scope.chartType = 'bar';

        var dom = document.getElementById("file-chart");
        var myChart = echarts.init(dom);

        var loopFile = function() {
            chartDraw($scope.label, 1, $scope.startTime, $scope.endTime, selectDevice($scope.selectByGroupModel), $scope.chartType, myChart);

        };
        loopFile();
        fileInterval = setInterval(loopFile, 60000);

        $('#file-timerange').daterangepicker({
            "showCustomRangeLabel": false,
            "autoApply": true,
            "timePicker": true,
            "applyClass": "btn-hide",
            "cancelClass": "btn-hide",
            "startDate": moment().subtract('hours', 24),
            "endDate": moment(),
            "ranges": {
                "过去24小时": [moment().subtract('hours', 24), moment()],
                "过去7天": [moment().subtract('days', 7), moment()],
                "过去30天": [moment().subtract('days', 30), moment()]
            },
            "locale": {
                "format": "YYYY/MM/DD HH:mm"
            }
        }, function (start, end, label) {
            if (label === "过去24小时") {
                $scope.startTime = Math.ceil(start / 3600000) * 3600;
            }
            else {
                $scope.startTime = Math.ceil(start / 86400000) * 86400 - 28800;
            }
            $("#file-time-selected").html(timeStamp2String($scope.startTime, "yyyy-MM-dd hh:mm") + ' 至 ' + timeStamp2String($scope.endTime, "yyyy-MM-dd hh:mm"));
            $scope.label = label;

            clearInterval(fileInterval);

            loopFile();
            fileInterval = setInterval(loopFile, 60000)
        });

        $scope.chartChange = function(type) {
            $scope.chartType = type;
            clearInterval(fileInterval);
            loopFile();
            fileInterval = setInterval(loopFile, 60000)
        };

        $scope.groupChange = {
            'onSelectionChanged': function () { // This event is not firing on selection of max limit
                clearInterval(fileInterval);
                loopFile();
                fileInterval = setInterval(loopFile, 60000)
            }
        }
    }

//    var fileDraw = function (label) {
//        var dom = document.getElementById("file-chart");
//        var myChart = echarts.init(dom);
//        var xData = getData(label);
//
//        var option = {
//            backgroundColor: "#ffffff",
//            "tooltip": {
//                "trigger": "axis",
//                "axisPointer": {
//                    "type": "shadow",
//                    textStyle: {
//                        color: "#fff"
//                    }
//                }
//            },
//            "grid": {
//                "borderWidth": 0,
//                "top": 40,
//                "bottom": 50,
//                textStyle: {
//                    color: "#fff"
//                }
//            },
//            "legend": {
//                x: '4%',
//                top: '92%',
//                textStyle: {
//                    color: '#363b4e'
//                },
//                "data": ['文件打开', '文件关闭', '文件创建', '读文件', '写文件', '删除文件']
//            },
//
//
//            "calculable": true,
//            "xAxis": [{
//                "type": "category",
//                "axisLine": {
//                    lineStyle: {
//                        color: '#363b4e'
//                    }
//                },
//                "splitLine": {
//                    "show": false
//                },
//                "axisTick": {
//                    "show": false
//                },
//                "splitArea": {
//                    "show": false
//                },
//                "axisLabel": {
//                    "interval": "auto"
//
//                },
//                "data": xData
//            }],
//            "yAxis": [{
//                "type": "value",
//                "splitLine": {
//                    "show": false
//                },
//                "axisLine": {
//                    lineStyle: {
//                        color: '#363b4e'
//                    }
//                },
//                "axisTick": {
//                    "show": false
//                },
//                "axisLabel": {
//                    "interval": "auto"
//                },
//                "splitArea": {
//                    "show": false
//                }
//
//            }],
//            // "dataZoom": [{
//            //     "show": true,
//            //     "height": 30,
//            //     "xAxisIndex": [
//            //         0
//            //     ],
//            //     bottom: 30,
//            //     "start": 10,
//            //     "end": 80,
//            //     handleIcon: 'path://M306.1,413c0,2.2-1.8,4-4,4h-59.8c-2.2,0-4-1.8-4-4V200.8c0-2.2,1.8-4,4-4h59.8c2.2,0,4,1.8,4,4V413z',
//            //     handleSize: '110%',
//            //     handleStyle:{
//            //         color:"#d3dee5",
//
//            //     },
//            //       textStyle:{
//            //         color:"#fff"},
//            //       borderColor:"#90979c"
//
//
//            // }, {
//            //     "type": "inside",
//            //     "show": true,
//            //     "height": 15,
//            //     "start": 1,
//            //     "end": 35
//            // }],
//            "series": [{
//                "name": "文件打开",
//                "type": "bar",
//                "stack": "总量",
//                "barWidth": 10,
//                "barGap": "10%",
//                "itemStyle": {
//                    "normal": {
//                        "color": "#ff2925",
//                        "label": {
//                            "show": false,
//                            "textStyle": {
//                                "color": "#fff"
//                            },
//                            "position": "insideTop",
//                            formatter: function (p) {
//                                return p.value > 0 ? (p.value) : '';
//                            }
//                        }
//                    }
//                },
//                "data": [
//                    198,
//                    330,
//                    151,
//                    160,
//                    222,
//                    229,
//                    128,
//                    250,
//                    224,
//                    473,
//                    126,
//                    260
//                ]
//            },
//
//                {
//                    "name": "文件关闭",
//                    "type": "bar",
//                    "stack": "总量",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#7030be",
//                            "barBorderRadius": 0,
//                            "label": {
//                                "show": false,
//                                "position": "top",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        82,
//                        67,
//                        62,
//                        59,
//                        67,
//                        67,
//                        35,
//                        71,
//                        81,
//                        78,
//                        79,
//                        72
//                    ]
//                },
//
//                {
//                    "name": "文件创建",
//                    "type": "bar",
//                    "stack": "总量",
//                    "barMaxWidth": 35,
//                    "barGap": "10%",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#0096fb",
//                            "label": {
//                                "show": false,
//                                "textStyle": {
//                                    "color": "#fff"
//                                },
//                                "position": "insideTop",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        198,
//                        330,
//                        151,
//                        160,
//                        222,
//                        229,
//                        128,
//                        250,
//                        224,
//                        473,
//                        126,
//                        260
//                    ]
//                },
//
//                {
//                    "name": "读文件",
//                    "type": "bar",
//                    "stack": "总量",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#c8df00",
//                            "barBorderRadius": 0,
//                            "label": {
//                                "show": false,
//                                "position": "top",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        82,
//                        67,
//                        62,
//                        59,
//                        67,
//                        67,
//                        35,
//                        71,
//                        81,
//                        78,
//                        79,
//                        72
//                    ]
//                },
//
//                {
//                    "name": "写文件",
//                    "type": "bar",
//                    "stack": "总量",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#f8aa27",
//                            "barBorderRadius": 0,
//                            "label": {
//                                "show": false,
//                                "position": "top",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        82,
//                        67,
//                        62,
//                        59,
//                        67,
//                        67,
//                        35,
//                        71,
//                        81,
//                        78,
//                        79,
//                        72
//                    ]
//                },
//
//                {
//                    "name": "删除文件",
//                    "type": "bar",
//                    "stack": "总量",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#795548",
//                            "barBorderRadius": 0,
//                            "label": {
//                                "show": false,
//                                "position": "top",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        82,
//                        67,
//                        62,
//                        59,
//                        67,
//                        67,
//                        35,
//                        71,
//                        81,
//                        78,
//                        79,
//                        72
//                    ]
//                }
//            ]
//        };
//
//        myChart.setOption(option);
//    };
//
//    fileDraw("今天");

    function registryController($scope) {
        $scope.selectByGroupModel = [];

        $scope.selectByGroupData = [];
        $scope.groupInfo = [];
        for (var i = 0; i < device_info.length; i++) {
            var devices = device_info[i].devices;
            $scope.groupInfo.push(device_info[i].groupname);
            for (var k = 0; k < devices.length; k++) {
                var device = {
                    id: devices[k].deviceid,
                    label: devices[k].devicename,
                    group: device_info[i].groupname
                };
                $scope.selectByGroupData.push(device)
            }
        }

        $scope.selectByGroupSettings = {
            selectByGroups: $scope.groupInfo,
            groupByTextProvider: function (groupValue) {
                return groupValue
            },
            scrollableHeight: '400px',
            scrollable: true,
            enableSearch: true
        };

        $scope.selectByGroupTexts = {
            buttonDefaultText: "所有探针设备...",
            selectGroup: '选择所有:',
            allSelectedText: '全部',
            searchPlaceholder: '检索...',
            checkAll: '选择所有',
            uncheckAll: '取消所有选择',
            selectionCount: '被选中'
        };
        $scope.startTime = initialStartTime;
        $scope.endTime = initialEndTime;
        $scope.label = "过去24小时";
        $scope.chartType = 'bar';

        var dom = document.getElementById("registry-chart");
        var myChart = echarts.init(dom);

        var loopRegistry = function() {
            chartDraw($scope.label, 5, $scope.startTime, $scope.endTime, selectDevice($scope.selectByGroupModel), $scope.chartType, myChart);

        };
        loopRegistry();
        registryInterval = setInterval(loopRegistry, 60000);

        $('#registry-timerange').daterangepicker({
            "showCustomRangeLabel": false,
            "autoApply": true,
            "timePicker": true,
            "applyClass": "btn-hide",
            "cancelClass": "btn-hide",
            "startDate": moment().subtract('hours', 24),
            "endDate": moment(),
            "ranges": {
                "过去24小时": [moment().subtract('hours', 24), moment()],
                "过去7天": [moment().subtract('days', 6), moment()],
                "过去30天": [moment().subtract('days', 29), moment()]
            },
            "locale": {
                "format": "YYYY/MM/DD HH:mm"
            }
        }, function (start, end, label) {
            if (label === "过去24小时") {
                $scope.startTime = Math.ceil(start / 3600000) * 3600;
            }
            else {
                $scope.startTime = Math.ceil(start / 86400000) * 86400 - 28800;
            }
            $("#registry-time-selected").html(timeStamp2String($scope.startTime, "yyyy-MM-dd hh:mm") + ' 至 ' + timeStamp2String($scope.endTime, "yyyy-MM-dd hh:mm"));
            $scope.label = label;

            clearInterval(registryInterval);

            loopRegistry();
            registryInterval = setInterval(loopRegistry, 60000)
        });

        $scope.chartChange = function(type) {
            $scope.chartType = type;
            clearInterval(registryInterval);
            loopRegistry();
            registryInterval = setInterval(loopRegistry, 60000)
        };

        $scope.groupChange = {
            'onSelectionChanged': function () { // This event is not firing on selection of max limit
                clearInterval(registryInterval);
                loopRegistry();
                registryInterval = setInterval(loopRegistry, 60000)
            }
        }
    }

//    var registryDraw = function (label, type) {
//        var dom = document.getElementById("registry-chart");
//        var myChart = echarts.init(dom);
//        var xData = getData(label);
//
//        var option = {
//            backgroundColor: "#ffffff",
//            "tooltip": {
//                "trigger": "axis",
//                "axisPointer": {
//                    "type": "shadow",
//                    textStyle: {
//                        color: "#fff"
//                    }
//                }
//            },
//            "grid": {
//                "borderWidth": 0,
//                "top": 40,
//                "bottom": 50,
//                textStyle: {
//                    color: "#fff"
//                }
//            },
//            "legend": {
//                x: '4%',
//                top: '92%',
//                left: '20%',
//                textStyle: {
//                    color: '#363b4e'
//                },
//                "data": ['设置键值', '读取键值', '创建键', '删除键']
//            },
//
//
//            "calculable": true,
//            "xAxis": [{
//                "type": "category",
//                "axisLine": {
//                    lineStyle: {
//                        color: '#363b4e'
//                    }
//                },
//                "splitLine": {
//                    "show": false
//                },
//                "axisTick": {
//                    "show": false
//                },
//                "splitArea": {
//                    "show": false
//                },
//                "axisLabel": {
//                    "interval": "auto"
//
//                },
//                "data": xData
//            }],
//            "yAxis": [{
//                "type": "value",
//                "splitLine": {
//                    "show": false
//                },
//                "axisLine": {
//                    lineStyle: {
//                        color: '#363b4e'
//                    }
//                },
//                "axisTick": {
//                    "show": false
//                },
//                "axisLabel": {
//                    "interval": "auto"
//                },
//                "splitArea": {
//                    "show": false
//                }
//
//            }],
//            // "dataZoom": [{
//            //     "show": true,
//            //     "height": 30,
//            //     "xAxisIndex": [
//            //         0
//            //     ],
//            //     bottom: 30,
//            //     "start": 10,
//            //     "end": 80,
//            //     handleIcon: 'path://M306.1,413c0,2.2-1.8,4-4,4h-59.8c-2.2,0-4-1.8-4-4V200.8c0-2.2,1.8-4,4-4h59.8c2.2,0,4,1.8,4,4V413z',
//            //     handleSize: '110%',
//            //     handleStyle:{
//            //         color:"#d3dee5",
//
//            //     },
//            //       textStyle:{
//            //         color:"#fff"},
//            //       borderColor:"#90979c"
//
//
//            // }, {
//            //     "type": "inside",
//            //     "show": true,
//            //     "height": 15,
//            //     "start": 1,
//            //     "end": 35
//            // }],
//            "series": [{
//                "name": "设置键值",
//                "type": type,
//                "stack": "总量1",
//                "barWidth": 10,
//                "barGap": "10%",
//                "itemStyle": {
//                    "normal": {
//                        "color": "#ff2925",
//                        "label": {
//                            "show": false,
//                            "textStyle": {
//                                "color": "#fff"
//                            },
//                            "position": "insideTop",
//                            formatter: function (p) {
//                                return p.value > 0 ? (p.value) : '';
//                            }
//                        }
//                    }
//                },
//                "data": [
//                    198,
//                    330,
//                    151,
//                    160,
//                    222,
//                    229,
//                    128,
//                    250,
//                    224,
//                    473,
//                    126,
//                    260
//                ]
//            },
//
//                {
//                    "name": "读取键值",
//                    "type": type,
//                    "stack": "总量2",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#7030be",
//                            "barBorderRadius": 0,
//                            "label": {
//                                "show": false,
//                                "position": "top",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        82,
//                        67,
//                        62,
//                        59,
//                        67,
//                        67,
//                        35,
//                        71,
//                        81,
//                        78,
//                        79,
//                        72
//                    ]
//                },
//
//                {
//                    "name": "创建键",
//                    "type": type,
//                    "stack": "总量3",
//                    "barMaxWidth": 35,
//                    "barGap": "10%",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#0096fb",
//                            "label": {
//                                "show": false,
//                                "textStyle": {
//                                    "color": "#fff"
//                                },
//                                "position": "insideTop",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        198,
//                        330,
//                        151,
//                        160,
//                        222,
//                        229,
//                        128,
//                        250,
//                        224,
//                        473,
//                        126,
//                        260
//                    ]
//                },
//
//                {
//                    "name": "删除键",
//                    "type": type,
//                    "stack": "总量4",
//                    "itemStyle": {
//                        "normal": {
//                            "color": "#c8df00",
//                            "barBorderRadius": 0,
//                            "label": {
//                                "show": false,
//                                "position": "top",
//                                formatter: function (p) {
//                                    return p.value > 0 ? (p.value) : '';
//                                }
//                            }
//                        }
//                    },
//                    "data": [
//                        82,
//                        67,
//                        62,
//                        59,
//                        67,
//                        67,
//                        35,
//                        71,
//                        81,
//                        78,
//                        79,
//                        72
//                    ]
//                }
//            ]
//        };
//
//            myChart.setOption(option);
//    };
//
//    registryDraw("今天", "line");
</script>
<!-- END MAIN CONTENT -->
<!-- BEGIN MAIN JS & CSS -->

<!-- BEGIN MAIN JS & CSS -->